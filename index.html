<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consolidaci√≥n Premium | Juancito Pe√±a</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  
  <style>
    :root {
      --primary-color: #007bff;
      --accent-color: #ff4757;
      --dark-bg: #1e272e;
      --text-main: #2d3436;
    }

    body {
      background: radial-gradient(circle at top right, #ffffff, #dfe6e9);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Inter', 'Segoe UI', sans-serif;
      color: var(--text-main);
    }

    /* --- Avatar Principal --- */
    .profile-container {
      position: fixed;
      top: 30px;
      right: 40px;
      z-index: 1000;
    }

    .profile-trigger {
      width: 110px;
      height: 110px;
      border-radius: 50%;
      border: 6px double var(--primary-color);
      padding: 4px;
      cursor: pointer;
      background: white;
      animation: heartbeat 1.5s infinite;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      object-fit: cover;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .profile-trigger:hover {
      transform: scale(1.15) rotate(10deg);
      border-color: var(--accent-color);
      animation-play-state: paused;
    }

    @keyframes heartbeat {
      0% { transform: scale(1); }
      15% { transform: scale(1.08); }
      30% { transform: scale(1); }
      45% { transform: scale(1.08); }
      100% { transform: scale(1); }
    }

    /* --- Herramienta de Consolidaci√≥n --- */
    .container-main { max-width: 1000px; width: 95%; }
    .card-consolidator {
      border: none;
      border-radius: 35px;
      box-shadow: 0 30px 60px rgba(0,0,0,0.12);
      background: #ffffff;
      border: 1px solid rgba(0,0,0,0.05);
    }

    h2 { font-size: 3.8rem; font-weight: 900; letter-spacing: -2px; color: #1e272e; }
    .form-label { font-size: 1.6rem; font-weight: 600; color: #636e72; }
    .form-control-lg { 
      padding: 22px; 
      font-size: 1.3rem; 
      border-radius: 18px;
      background: #f8f9fa;
      border: 2px solid transparent;
      transition: 0.3s;
    }
    .form-control-lg:focus { border-color: var(--primary-color); box-shadow: none; background: white; }
    
    .btn-massive {
      padding: 28px;
      font-size: 2rem;
      font-weight: 800;
      border-radius: 20px;
      text-transform: uppercase;
      box-shadow: 0 15px 30px rgba(13, 110, 253, 0.25);
      transition: 0.4s;
    }
    .btn-massive:hover { transform: translateY(-3px); box-shadow: 0 20px 40px rgba(13, 110, 253, 0.4); }

    /* --- MODAL DE PRESENTACI√ìN PREMIUM --- */
    .modal-xxl { max-width: 850px; }
    .modal-content { 
      border-radius: 50px; 
      border: none; 
      overflow: visible;
      background: #ffffff;
    }
    
    .modal-header-banner { 
      background: linear-gradient(135deg, #007bff 0%, #00d2ff 100%);
      height: 180px;
      border-radius: 50px 50px 0 0;
      position: relative;
    }

    .modal-photo-center {
      width: 220px;
      height: 220px;
      border-radius: 50%;
      border: 10px solid white;
      position: absolute;
      left: 50%;
      bottom: -110px;
      transform: translateX(-50%);
      box-shadow: 0 20px 40px rgba(0,0,0,0.15);
      object-fit: cover;
      background: #f8f9fa;
    }

    .modal-body { padding: 130px 50px 60px 50px; }
    .dev-name { font-size: 3.5rem; font-weight: 900; margin-bottom: 5px; color: #1e272e; }
    .dev-subtitle { font-size: 1.2rem; color: var(--primary-color); font-weight: 700; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 30px; }
    
    .bio-box {
      background: #f8f9fa;
      padding: 35px;
      border-radius: 30px;
      font-size: 1.25rem;
      line-height: 1.8;
      text-align: left;
      border-left: 8px solid var(--primary-color);
    }

    .skill-tag {
      display: inline-block;
      background: white;
      padding: 5px 15px;
      border-radius: 10px;
      margin: 4px;
      font-size: 0.95rem;
      font-weight: 600;
      border: 1px solid #ddd;
    }

    /* Redes Sociales */
    .social-btn {
      width: 75px;
      height: 75px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 22px;
      margin: 15px;
      font-size: 2.5rem;
      color: white;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .social-btn:hover { transform: translateY(-10px); filter: brightness(1.1); color: white; }
    .bg-youtube { background: #ff0000; box-shadow: 0 10px 20px rgba(255,0,0,0.2); }
    .bg-linkedin { background: #0077b5; box-shadow: 0 10px 20px rgba(0,119,181,0.2); }
    .bg-github { background: #24292e; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }

    #status { font-size: 2rem; margin-top: 25px; }
  </style>
</head>
<body>

  <div class="profile-container">
    <img src="https://avatars.githubusercontent.com/u/38921558?v=4" alt="Juancito Pe√±a" 
         class="profile-trigger" 
         data-bs-toggle="modal" 
         data-bs-target="#devModal"
         title="Conoce al desarrollador">
  </div>

  <div class="container container-main">
    <div class="card card-consolidator p-5 text-center">
      <h2 class="mb-2">üìä Consolidar Excel Pro</h2>
      <p class="fs-4 text-muted mb-5">Unifica reportes complejos con precisi√≥n de ingenier√≠a</p>
      
      <div class="text-start mb-5 px-4">
        <label for="excelFiles" class="form-label mb-3">Arrastra o selecciona tus archivos:</label>
        <input class="form-control form-control-lg shadow-sm" type="file" id="excelFiles" multiple accept=".xlsx,.xls">
      </div>
      
      <button id="consolidarBtn" class="btn btn-primary w-100 btn-massive">
        <i class="fa-solid fa-wand-magic-sparkles me-3"></i> Consolidar Ahora
      </button>
      
      <div id="status" class="fw-bold"></div>
    </div>
  </div>

  <div class="modal fade" id="devModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xxl">
      <div class="modal-content">
        <div class="modal-header-banner">
            <button type="button" class="btn-close btn-close-white p-4 position-absolute top-0 end-0" data-bs-dismiss="modal" aria-label="Close"></button>
            <img src="https://avatars.githubusercontent.com/u/38921558?v=4" alt="Juancito Pe√±a" class="modal-photo-center">
        </div>
        
        <div class="modal-body text-center">
            <h1 class="dev-name">Juancito Pe√±a</h1>
            <p class="dev-subtitle">Full Stack Developer ‚Ä¢ Data Scientist ‚Ä¢ Educator</p>
            
            <div class="bio-box shadow-sm mb-5">
              <strong>üõ†Ô∏è Ingeniero en Sistemas</strong> con especialidad en Desarrollo de Software.<br>
              <strong>üéì Postgrados:</strong> Maestr√≠a en Sistema Menci√≥n Gerencial y Maestr√≠a en Ciencia de Datos y Business Intelligence.<br>
              <strong>üß† IA:</strong> Prompt Engineer experto en Inteligencia Artificial.<br>
              <strong>üíª Stack:</strong> React, .NET, C#, ASP.NET, Python, PHP, WordPress, Git.<br>
              <strong>üìä Datos:</strong> Experto en Excel Avanzado, SQL, Power BI y An√°lisis con Python.<br>
              <strong>üë®‚Äçüè´ Vocaci√≥n:</strong> Docente apasionado por compartir el conocimiento t√©cnico.
            </div>

<div class="d-flex justify-content-center flex-wrap mt-4">
  <a href="https://www.youtube.com/@JuancitoDevV" 
     target="_blank" 
     rel="noopener noreferrer" 
     class="social-btn bg-youtube" 
     title="Visita mi canal de YouTube">
     <i class="fab fa-youtube"></i>
  </a>

  <a href="https://www.linkedin.com/in/juancitope%C3%B1a/" 
     target="_blank" 
     rel="noopener noreferrer" 
     class="social-btn bg-linkedin" 
     title="Con√©ctame en LinkedIn">
     <i class="fab fa-linkedin-in"></i>
  </a>

  <a href="https://github.com/JUANCITOPENA" 
     target="_blank" 
     rel="noopener noreferrer" 
     class="social-btn bg-github" 
     title="Mira mis proyectos en GitHub">
     <i class="fab fa-github"></i>
  </a>
</div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.getElementById("consolidarBtn").addEventListener("click", async () => {
      const input = document.getElementById("excelFiles");
      const files = input.files;
      
      if (files.length === 0) { 
        alert("Por favor, selecciona los archivos Excel primero."); 
        return; 
      }

      const statusDiv = document.getElementById("status");
      statusDiv.innerHTML = "<span class='text-primary animate-pulse'>‚è≥ Procesando datos...</span>";

      try {
        // 1. Consolidar los datos
        let allData = [];
        for (let file of files) {
          const data = await file.arrayBuffer();
          const workbook = XLSX.read(data, { type: "array" });
          const sheet = workbook.Sheets[workbook.SheetNames[0]];
          const jsonData = XLSX.utils.sheet_to_json(sheet, { defval: "" });
          allData = allData.concat(jsonData);
        }

        const newWS = XLSX.utils.json_to_sheet(allData);
        const newWB = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(newWB, newWS, "Consolidado");
        
        // Generar el contenido del Excel
        const excelBuffer = XLSX.write(newWB, { bookType: 'xlsx', type: 'array' });

        // 2. Abrir el cuadro de di√°logo "Guardar como" nativo
        if ('showSaveFilePicker' in window) {
          const opts = {
            suggestedName: 'Inventario_Consolidado.xlsx',
            types: [{
              description: 'Archivo de Excel',
              accept: {'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': ['.xlsx']},
            }],
          };
          
          // Esto abre la ventana de Windows/Mac para elegir carpeta y nombre
          const handle = await window.showSaveFilePicker(opts);
          const writable = await handle.createWritable();
          await writable.write(excelBuffer);
          await writable.close();
          
          statusDiv.innerHTML = "<span class='text-success'>‚úÖ Archivo guardado correctamente.</span>";
        } else {
          // Si el navegador es muy antiguo, usa la descarga autom√°tica
          XLSX.writeFile(newWB, "Inventario_Consolidado.xlsx");
          statusDiv.innerHTML = "<span class='text-success'>‚úÖ Archivo generado (Descarga directa).</span>";
        }

      } catch (error) {
        console.error(error);
        if (error.name === 'AbortError') {
          statusDiv.innerHTML = "<span class='text-secondary'>‚ö†Ô∏è Guardado cancelado.</span>";
        } else {
          statusDiv.innerHTML = "<span class='text-danger'>‚ùå Error al procesar el archivo.</span>";
        }
      }
    });
  </script>
</body>
</html>
